<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan BSPS Jawa Timur 2026 - Cetak</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        @page {
            size: A4 portrait;
            margin: 0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #f1f5f9;
            color: #1e293b;
            min-height: 100vh;
        }

        .page {
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            background: white;
            position: relative;
            overflow: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            padding: 20mm 15mm 15mm;
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -20mm;
            left: 0;
            right: 0;
            height: 40mm;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            clip-path: polygon(0 0, 100% 0, 100% 30%, 0 100%);
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .logo-row {
            display: flex;
            align-items: center;
            gap: 4mm;
            margin-bottom: 3mm;
        }

        .logo {
            width: 12mm;
            height: 12mm;
            background: linear-gradient(135deg, #22c55e, #0ea5e9);
            border-radius: 3mm;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo svg {
            width: 7mm;
            height: 7mm;
        }

        .title {
            font-size: 7mm;
            font-weight: 800;
        }

        .subtitle {
            font-size: 3.5mm;
            color: #94a3b8;
            margin-bottom: 5mm;
        }

        .tahap-badge {
            display: inline-block;
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            padding: 1.5mm 4mm;
            border-radius: 3mm;
            font-size: 3mm;
            font-weight: 600;
        }

        /* Total Stats */
        .total-section {
            position: relative;
            z-index: 2;
            padding: 0 15mm;
            margin-top: -8mm;
        }

        .total-card {
            background: white;
            border-radius: 4mm;
            padding: 6mm;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .total-item {
            flex: 1;
        }

        .total-value {
            font-size: 8mm;
            font-weight: 800;
            color: #0f172a;
        }

        .total-value span {
            font-size: 4mm;
            color: #64748b;
        }

        .total-label {
            font-size: 2.5mm;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5mm;
            margin-top: 1mm;
        }

        /* Categories */
        .categories {
            padding: 8mm 15mm;
            display: flex;
            gap: 5mm;
        }

        .category {
            flex: 1;
            border-radius: 4mm;
            padding: 5mm;
            position: relative;
            overflow: hidden;
        }

        .cat-perdesaan {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 0.3mm solid #bbf7d0;
        }

        .cat-perkotaan {
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            border: 0.3mm solid #e9d5ff;
        }

        .cat-pesisir {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 0.3mm solid #bae6fd;
        }

        .cat-header {
            display: flex;
            align-items: center;
            gap: 2mm;
            margin-bottom: 3mm;
        }

        .cat-icon {
            width: 8mm;
            height: 8mm;
            border-radius: 2mm;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4mm;
        }

        .cat-perdesaan .cat-icon {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .cat-perkotaan .cat-icon {
            background: linear-gradient(135deg, #a855f7, #9333ea);
        }

        .cat-pesisir .cat-icon {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
        }

        .cat-title {
            font-size: 4mm;
            font-weight: 700;
            color: #1e293b;
        }

        .cat-stats {
            display: flex;
            gap: 3mm;
            margin-bottom: 3mm;
        }

        .cat-stat {
            flex: 1;
            text-align: center;
            background: rgba(255, 255, 255, 0.7);
            padding: 2mm;
            border-radius: 2mm;
        }

        .cat-stat-value {
            font-size: 4mm;
            font-weight: 700;
        }

        .cat-perdesaan .cat-stat-value {
            color: #16a34a;
        }

        .cat-perkotaan .cat-stat-value {
            color: #9333ea;
        }

        .cat-pesisir .cat-stat-value {
            color: #0284c7;
        }

        .cat-stat-label {
            font-size: 2mm;
            color: #64748b;
            text-transform: uppercase;
        }

        .cat-breakdown {
            font-size: 2.5mm;
        }

        .cat-row {
            display: flex;
            justify-content: space-between;
            padding: 1mm 0;
            border-bottom: 0.2mm solid rgba(0, 0, 0, 0.05);
        }

        .cat-row:last-child {
            border-bottom: none;
        }

        .cat-kab {
            color: #475569;
        }

        .cat-unit {
            font-weight: 600;
        }

        /* Chart Area */
        .chart-section {
            padding: 5mm 15mm;
        }

        .chart-title {
            font-size: 4mm;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4mm;
            display: flex;
            align-items: center;
            gap: 2mm;
        }

        .chart-title::before {
            content: '';
            width: 1mm;
            height: 5mm;
            background: linear-gradient(135deg, #22c55e, #0ea5e9);
            border-radius: 0.5mm;
        }

        .chart-container {
            display: flex;
            gap: 5mm;
        }

        .chart-bars {
            flex: 2;
        }

        .bar-row {
            display: flex;
            align-items: center;
            gap: 3mm;
            margin-bottom: 2mm;
        }

        .bar-label {
            width: 25mm;
            font-size: 2.5mm;
            color: #475569;
            text-align: right;
        }

        .bar-track {
            flex: 1;
            height: 5mm;
            background: #f1f5f9;
            border-radius: 1mm;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 1mm;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 2mm;
        }

        .bar-value {
            font-size: 2mm;
            font-weight: 600;
            color: white;
        }

        .chart-legend {
            flex: 1;
            padding: 3mm;
            background: #f8fafc;
            border-radius: 3mm;
        }

        .legend-title {
            font-size: 2.5mm;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 2mm;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 2mm;
            font-size: 2.3mm;
            margin-bottom: 1.5mm;
        }

        .legend-color {
            width: 3mm;
            height: 3mm;
            border-radius: 0.5mm;
        }

        /* Footer */
        .footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: #f8fafc;
            padding: 5mm 15mm;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 0.3mm solid #e2e8f0;
        }

        .footer-left {
            font-size: 2.5mm;
            color: #64748b;
        }

        .footer-left strong {
            color: #1e293b;
        }

        .footer-right {
            font-size: 2mm;
            color: #94a3b8;
        }

        /* Print Button */
        .print-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #22c55e, #0ea5e9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .print-btn:hover {
            transform: translateY(-2px);
        }

        @media print {
            body {
                background: white;
            }

            .page {
                margin: 0;
                box-shadow: none;
            }

            .print-btn {
                display: none;
            }
        }

        @media screen {
            .page {
                box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
                margin: 20px auto;
            }
        }
    </style>
</head>

<body>
    <button class="print-btn" onclick="window.print()">üñ®Ô∏è Cetak PDF</button>

    <div class="page">
        <div class="header">
            <div class="header-content">
                <div class="logo-row">
                    <div class="logo">
                        <svg viewBox="0 0 24 24" fill="none">
                            <rect x="3" y="14" width="4" height="7" rx="1" fill="white" />
                            <rect x="10" y="8" width="4" height="13" rx="1" fill="white" />
                            <rect x="17" y="3" width="4" height="18" rx="1" fill="white" />
                        </svg>
                    </div>
                    <div>
                        <div class="title">BSPS Jawa Timur 2026</div>
                        <div class="subtitle">Bantuan Stimulan Perumahan Swadaya</div>
                    </div>
                </div>
                <span class="tahap-badge">üìÖ Tahap I</span>
            </div>
        </div>

        <div class="total-section">
            <div class="total-card">
                <div class="total-item">
                    <div class="total-value" id="grandTotal">-</div>
                    <div class="total-label">Total Unit Alokasi</div>
                </div>
                <div class="total-item">
                    <div class="total-value" id="grandDesa">- <span>Lokasi</span></div>
                    <div class="total-label">Total Desa/Kelurahan</div>
                </div>
                <div class="total-item">
                    <div class="total-value" id="grandKab">- <span>Wilayah</span></div>
                    <div class="total-label">Kabupaten/Kota</div>
                </div>
            </div>
        </div>

        <div class="categories">
            <div class="category cat-perdesaan">
                <div class="cat-header">
                    <div class="cat-icon">üèòÔ∏è</div>
                    <div class="cat-title">PERDESAAN</div>
                </div>
                <div class="cat-stats">
                    <div class="cat-stat">
                        <div class="cat-stat-value" id="desa-unit">-</div>
                        <div class="cat-stat-label">Unit</div>
                    </div>
                    <div class="cat-stat">
                        <div class="cat-stat-value" id="desa-count">-</div>
                        <div class="cat-stat-label">Desa</div>
                    </div>
                </div>
                <div class="cat-breakdown" id="desa-breakdown"></div>
            </div>
            <div class="category cat-perkotaan">
                <div class="cat-header">
                    <div class="cat-icon">üèôÔ∏è</div>
                    <div class="cat-title">PERKOTAAN</div>
                </div>
                <div class="cat-stats">
                    <div class="cat-stat">
                        <div class="cat-stat-value" id="kota-unit">-</div>
                        <div class="cat-stat-label">Unit</div>
                    </div>
                    <div class="cat-stat">
                        <div class="cat-stat-value" id="kota-count">-</div>
                        <div class="cat-stat-label">Kel</div>
                    </div>
                </div>
                <div class="cat-breakdown" id="kota-breakdown"></div>
            </div>
            <div class="category cat-pesisir">
                <div class="cat-header">
                    <div class="cat-icon">üåä</div>
                    <div class="cat-title">PESISIR</div>
                </div>
                <div class="cat-stats">
                    <div class="cat-stat">
                        <div class="cat-stat-value" id="pesisir-unit">-</div>
                        <div class="cat-stat-label">Unit</div>
                    </div>
                    <div class="cat-stat">
                        <div class="cat-stat-value" id="pesisir-count">-</div>
                        <div class="cat-stat-label">Desa</div>
                    </div>
                </div>
                <div class="cat-breakdown" id="pesisir-breakdown"></div>
            </div>
        </div>

        <div class="chart-section">
            <div class="chart-title">Distribusi Alokasi Per Kabupaten/Kota</div>
            <div class="chart-container">
                <div class="chart-bars" id="chartBars"></div>
                <div class="chart-legend">
                    <div class="legend-title">Keterangan</div>
                    <div class="legend-item">
                        <div class="legend-color" style="background:#22c55e;"></div> Perdesaan
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background:#a855f7;"></div> Perkotaan
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background:#0ea5e9;"></div> Pesisir
                    </div>
                    <div style="margin-top:4mm; padding-top:3mm; border-top:0.2mm solid #e2e8f0;">
                        <div class="legend-title">Dicetak</div>
                        <div style="font-size:2.2mm; color:#475569;" id="printDate"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="footer-left">
                <strong>BP3KP Jawa IV</strong><br>
                Jl. Gayung Kebonsari 50, Surabaya
            </div>
            <div class="footer-right">
                Dashboard BSPS Jawa Timur 2026 | Tahap I
            </div>
        </div>
    </div>

    <script>
        let allData = { desa: [], kota: [], pesisir: [] };

        async function loadAllData() {
            try {
                const [d1, d2, d3] = await Promise.all([
                    fetch('data_desa.json').then(r => r.json()),
                    fetch('data_kota.json').then(r => r.json()),
                    fetch('data_pesisir.json').then(r => r.json())
                ]);
                allData = { desa: d1, kota: d2, pesisir: d3 };
                renderAll();
            } catch (e) { console.error(e); }
        }

        function renderAll() {
            const { desa, kota, pesisir } = allData;

            // Grand totals
            const totalUnit = desa.reduce((s, i) => s + i.j, 0) + kota.reduce((s, i) => s + i.j, 0) + pesisir.reduce((s, i) => s + i.j, 0);
            const totalLokasi = desa.length + kota.length + pesisir.length;
            const allKab = [...new Set([...desa, ...kota, ...pesisir].map(i => i.kb))];

            document.getElementById('grandTotal').textContent = totalUnit.toLocaleString('id-ID');
            document.getElementById('grandDesa').innerHTML = `${totalLokasi} <span>Lokasi</span>`;
            document.getElementById('grandKab').innerHTML = `${allKab.length} <span>Wilayah</span>`;

            // Category stats
            renderCategory(desa, 'desa');
            renderCategory(kota, 'kota');
            renderCategory(pesisir, 'pesisir');

            // Chart
            renderChart();

            // Date
            document.getElementById('printDate').textContent = new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }

        function renderCategory(data, prefix) {
            const total = data.reduce((s, i) => s + i.j, 0);
            const grouped = {};
            data.forEach(i => { grouped[i.kb] = (grouped[i.kb] || 0) + i.j; });
            const sorted = Object.entries(grouped).sort((a, b) => b[1] - a[1]);

            document.getElementById(`${prefix}-unit`).textContent = total.toLocaleString('id-ID');
            document.getElementById(`${prefix}-count`).textContent = data.length;
            document.getElementById(`${prefix}-breakdown`).innerHTML = sorted.map(([kab, unit]) =>
                `<div class="cat-row"><span class="cat-kab">${kab.replace('KAB. ', '').replace('KOTA ', '')}</span><span class="cat-unit">${unit}</span></div>`
            ).join('');
        }

        function renderChart() {
            const { desa, kota, pesisir } = allData;
            const all = [...desa, ...kota, ...pesisir];
            const grouped = {};
            all.forEach(i => { grouped[i.kb] = (grouped[i.kb] || 0) + i.j; });
            const sorted = Object.entries(grouped).sort((a, b) => b[1] - a[1]);
            const max = sorted[0]?.[1] || 1;

            const colors = {
                'KAB. PACITAN': '#22c55e', 'KAB. MALANG': '#22c55e', 'KAB. PASURUAN': '#22c55e',
                'KAB. JOMBANG': '#22c55e', 'KAB. NGANJUK': '#22c55e', 'KAB. MADIUN': '#22c55e',
                'KAB. BOJONEGORO': '#22c55e', 'KAB. JEMBER': '#22c55e', 'KAB. GRESIK': '#22c55e',
                'KOTA MALANG': '#a855f7', 'KOTA PASURUAN': '#a855f7',
                'KAB. BANYUWANGI': '#0ea5e9', 'KAB. SITUBONDO': '#0ea5e9'
            };

            document.getElementById('chartBars').innerHTML = sorted.map(([kab, unit]) => {
                const pct = (unit / max * 100).toFixed(0);
                const color = colors[kab] || '#64748b';
                return `<div class="bar-row">
                    <div class="bar-label">${kab.replace('KAB. ', '').replace('KOTA ', '')}</div>
                    <div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:${color};"><span class="bar-value">${unit}</span></div></div>
                </div>`;
            }).join('');
        }

        loadAllData();
    </script>
</body>

</html>