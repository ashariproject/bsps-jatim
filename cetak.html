<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan BSPS Jawa Timur 2026 - Cetak</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        @page {
            size: A4 portrait;
            margin: 0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #f1f5f9;
            color: #1e293b;
        }

        .page {
            width: 210mm;
            height: 297mm;
            margin: 0 auto;
            background: white;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            padding: 6mm 12mm;
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -8mm;
            left: 0;
            right: 0;
            height: 16mm;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            clip-path: polygon(0 0, 100% 0, 100% 30%, 0 100%);
        }

        .header-content {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-row {
            display: flex;
            align-items: center;
            gap: 3mm;
        }

        .logo {
            width: 9mm;
            height: 9mm;
            background: linear-gradient(135deg, #22c55e, #0ea5e9);
            border-radius: 2mm;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo svg {
            width: 5mm;
            height: 5mm;
        }

        .title {
            font-size: 5mm;
            font-weight: 800;
        }

        .subtitle {
            font-size: 2.5mm;
            color: #94a3b8;
        }

        .tahap-badge {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            padding: 1.2mm 3mm;
            border-radius: 2mm;
            font-size: 2.5mm;
            font-weight: 600;
        }

        /* Total Stats */
        .total-section {
            position: relative;
            z-index: 2;
            padding: 0 12mm;
            margin-top: -2mm;
        }

        .total-card {
            background: white;
            border-radius: 3mm;
            padding: 3mm 5mm;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .total-item {
            flex: 1;
        }

        .total-value {
            font-size: 5mm;
            font-weight: 800;
            color: #0f172a;
        }

        .total-value span {
            font-size: 2.5mm;
            color: #64748b;
        }

        .total-label {
            font-size: 1.8mm;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.3mm;
        }

        /* Map Section */
        .map-section {
            padding: 4mm 12mm 2mm;
        }

        .section-title {
            font-size: 3mm;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 2mm;
            display: flex;
            align-items: center;
            gap: 2mm;
        }

        .section-title::before {
            content: '';
            width: 1mm;
            height: 3.5mm;
            background: linear-gradient(135deg, #22c55e, #0ea5e9);
            border-radius: 0.5mm;
        }

        .map-container {
            position: relative;
            width: 100%;
            height: 65mm;
            background: linear-gradient(135deg, #f0fdf4 0%, #e0f2fe 100%);
            border-radius: 3mm;
            border: 0.2mm solid #e2e8f0;
            overflow: hidden;
        }

        .map-svg {
            width: 100%;
            height: 100%;
        }

        .map-label {
            position: absolute;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none;
        }

        .map-label-value {
            font-size: 2.8mm;
            font-weight: 700;
            color: white;
            background: #0f172a;
            padding: 0.8mm 1.5mm;
            border-radius: 1mm;
            display: block;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .map-label-name {
            font-size: 1.6mm;
            color: #475569;
            margin-top: 0.5mm;
            display: block;
        }

        .map-label.green .map-label-value {
            background: #16a34a;
        }

        .map-label.purple .map-label-value {
            background: #9333ea;
        }

        .map-label.blue .map-label-value {
            background: #0284c7;
        }

        /* Categories */
        .categories {
            padding: 3mm 12mm;
            display: flex;
            gap: 3mm;
        }

        .category {
            flex: 1;
            border-radius: 2.5mm;
            padding: 3mm;
        }

        .cat-perdesaan {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border: 0.2mm solid #bbf7d0;
        }

        .cat-perkotaan {
            background: linear-gradient(135deg, #faf5ff, #f3e8ff);
            border: 0.2mm solid #e9d5ff;
        }

        .cat-pesisir {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 0.2mm solid #bae6fd;
        }

        .cat-header {
            display: flex;
            align-items: center;
            gap: 1.5mm;
            margin-bottom: 1.5mm;
        }

        .cat-icon {
            width: 5mm;
            height: 5mm;
            border-radius: 1.2mm;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5mm;
        }

        .cat-perdesaan .cat-icon {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .cat-perkotaan .cat-icon {
            background: linear-gradient(135deg, #a855f7, #9333ea);
        }

        .cat-pesisir .cat-icon {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
        }

        .cat-title {
            font-size: 3mm;
            font-weight: 700;
            color: #1e293b;
        }

        .cat-stats {
            display: flex;
            gap: 2mm;
            margin-bottom: 1.5mm;
        }

        .cat-stat {
            flex: 1;
            text-align: center;
            background: rgba(255, 255, 255, 0.7);
            padding: 1.2mm;
            border-radius: 1.2mm;
        }

        .cat-stat-value {
            font-size: 3mm;
            font-weight: 700;
        }

        .cat-perdesaan .cat-stat-value {
            color: #16a34a;
        }

        .cat-perkotaan .cat-stat-value {
            color: #9333ea;
        }

        .cat-pesisir .cat-stat-value {
            color: #0284c7;
        }

        .cat-stat-label {
            font-size: 1.5mm;
            color: #64748b;
            text-transform: uppercase;
        }

        .cat-breakdown {
            font-size: 2mm;
            max-height: 22mm;
            overflow: hidden;
        }

        .cat-row {
            display: flex;
            justify-content: space-between;
            padding: 0.6mm 0;
            border-bottom: 0.1mm solid rgba(0, 0, 0, 0.05);
        }

        .cat-row:last-child {
            border-bottom: none;
        }

        .cat-kab {
            color: #475569;
        }

        .cat-unit {
            font-weight: 600;
        }

        /* Chart */
        .chart-section {
            flex: 1;
            padding: 3mm 12mm;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .chart-container {
            flex: 1;
            display: flex;
            gap: 3mm;
            min-height: 0;
        }

        .chart-bars {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 1.2mm;
            overflow: hidden;
        }

        .bar-row {
            display: flex;
            align-items: center;
            gap: 1.5mm;
        }

        .bar-label {
            width: 20mm;
            font-size: 2mm;
            color: #475569;
            text-align: right;
        }

        .bar-track {
            flex: 1;
            height: 3.5mm;
            background: #f1f5f9;
            border-radius: 0.8mm;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 0.8mm;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 1.2mm;
        }

        .bar-value {
            font-size: 1.6mm;
            font-weight: 600;
            color: white;
        }

        .chart-legend {
            width: 30mm;
            padding: 2.5mm;
            background: #f8fafc;
            border-radius: 2mm;
        }

        .legend-title {
            font-size: 2mm;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 1.5mm;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 1.2mm;
            font-size: 1.8mm;
            margin-bottom: 1.2mm;
            color: #475569;
        }

        .legend-color {
            width: 2.2mm;
            height: 2.2mm;
            border-radius: 0.4mm;
        }

        .legend-divider {
            margin-top: 2mm;
            padding-top: 1.5mm;
            border-top: 0.1mm solid #e2e8f0;
        }

        /* Footer */
        .footer {
            background: #f8fafc;
            padding: 3mm 12mm;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 0.2mm solid #e2e8f0;
        }

        .footer-left {
            font-size: 2mm;
            color: #64748b;
        }

        .footer-left strong {
            color: #1e293b;
        }

        .footer-right {
            font-size: 1.6mm;
            color: #94a3b8;
        }

        /* Print */
        .print-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #22c55e, #0ea5e9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: inherit;
        }

        .print-btn:hover {
            transform: translateY(-2px);
        }

        @media print {
            body {
                background: white;
            }

            .page {
                margin: 0;
                box-shadow: none;
            }

            .print-btn {
                display: none;
            }
        }

        @media screen {
            .page {
                box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
                margin: 20px auto;
            }
        }
    </style>
</head>

<body>
    <button class="print-btn" onclick="window.print()">üñ®Ô∏è Cetak PDF</button>

    <div class="page">
        <div class="header">
            <div class="header-content">
                <div class="logo-row">
                    <div class="logo">
                        <svg viewBox="0 0 24 24" fill="none">
                            <rect x="3" y="14" width="4" height="7" rx="1" fill="white" />
                            <rect x="10" y="8" width="4" height="13" rx="1" fill="white" />
                            <rect x="17" y="3" width="4" height="18" rx="1" fill="white" />
                        </svg>
                    </div>
                    <div>
                        <div class="title">BSPS Jawa Timur 2026</div>
                        <div class="subtitle">Bantuan Stimulan Perumahan Swadaya</div>
                    </div>
                </div>
                <span class="tahap-badge">üìÖ Tahap I</span>
            </div>
        </div>

        <div class="total-section">
            <div class="total-card">
                <div class="total-item">
                    <div class="total-value" id="grandTotal">-</div>
                    <div class="total-label">Total Unit Alokasi</div>
                </div>
                <div class="total-item">
                    <div class="total-value" id="grandDesa">- <span>Lokasi</span></div>
                    <div class="total-label">Total Desa/Kelurahan</div>
                </div>
                <div class="total-item">
                    <div class="total-value" id="grandKab">- <span>Wilayah</span></div>
                    <div class="total-label">Kabupaten/Kota</div>
                </div>
            </div>
        </div>

        <div class="map-section">
            <div class="section-title">Peta Sebaran Alokasi BSPS</div>
            <div class="map-container">
                <svg class="map-svg" viewBox="0 0 400 160" preserveAspectRatio="xMidYMid meet">
                    <!-- Simplified East Java Map Shape -->
                    <defs>
                        <linearGradient id="mapGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#e2e8f0" />
                            <stop offset="100%" style="stop-color:#cbd5e1" />
                        </linearGradient>
                    </defs>
                    <!-- Main Java Island Shape (simplified) -->
                    <path
                        d="M10,80 Q30,40 80,35 L120,30 Q150,25 180,30 L220,35 Q260,30 300,35 L340,45 Q370,55 390,70 L395,85 Q390,100 370,110 L340,120 Q300,130 260,125 L220,118 Q180,115 140,118 L100,125 Q60,130 30,115 L15,100 Q5,90 10,80 Z"
                        fill="url(#mapGrad)" stroke="#94a3b8" stroke-width="0.5" />
                    <!-- Madura Island -->
                    <path
                        d="M280,45 Q290,38 320,35 L350,38 Q365,42 370,50 L368,58 Q360,65 340,68 L310,65 Q290,60 280,52 Z"
                        fill="url(#mapGrad)" stroke="#94a3b8" stroke-width="0.5" />
                </svg>
                <!-- Map Labels - dynamically positioned -->
                <div id="mapLabels"></div>
            </div>
        </div>

        <div class="categories">
            <div class="category cat-perdesaan">
                <div class="cat-header">
                    <div class="cat-icon">üèòÔ∏è</div>
                    <div class="cat-title">PERDESAAN</div>
                </div>
                <div class="cat-stats">
                    <div class="cat-stat">
                        <div class="cat-stat-value" id="desa-unit">-</div>
                        <div class="cat-stat-label">Unit</div>
                    </div>
                    <div class="cat-stat">
                        <div class="cat-stat-value" id="desa-count">-</div>
                        <div class="cat-stat-label">Desa</div>
                    </div>
                </div>
                <div class="cat-breakdown" id="desa-breakdown"></div>
            </div>
            <div class="category cat-perkotaan">
                <div class="cat-header">
                    <div class="cat-icon">üèôÔ∏è</div>
                    <div class="cat-title">PERKOTAAN</div>
                </div>
                <div class="cat-stats">
                    <div class="cat-stat">
                        <div class="cat-stat-value" id="kota-unit">-</div>
                        <div class="cat-stat-label">Unit</div>
                    </div>
                    <div class="cat-stat">
                        <div class="cat-stat-value" id="kota-count">-</div>
                        <div class="cat-stat-label">Kel</div>
                    </div>
                </div>
                <div class="cat-breakdown" id="kota-breakdown"></div>
            </div>
            <div class="category cat-pesisir">
                <div class="cat-header">
                    <div class="cat-icon">üåä</div>
                    <div class="cat-title">PESISIR</div>
                </div>
                <div class="cat-stats">
                    <div class="cat-stat">
                        <div class="cat-stat-value" id="pesisir-unit">-</div>
                        <div class="cat-stat-label">Unit</div>
                    </div>
                    <div class="cat-stat">
                        <div class="cat-stat-value" id="pesisir-count">-</div>
                        <div class="cat-stat-label">Desa</div>
                    </div>
                </div>
                <div class="cat-breakdown" id="pesisir-breakdown"></div>
            </div>
        </div>

        <div class="chart-section">
            <div class="section-title">Distribusi Alokasi Per Kabupaten/Kota</div>
            <div class="chart-container">
                <div class="chart-bars" id="chartBars"></div>
                <div class="chart-legend">
                    <div class="legend-title">Keterangan</div>
                    <div class="legend-item">
                        <div class="legend-color" style="background:#22c55e;"></div> Perdesaan
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background:#a855f7;"></div> Perkotaan
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background:#0ea5e9;"></div> Pesisir
                    </div>
                    <div class="legend-divider">
                        <div class="legend-title">Dicetak</div>
                        <div style="font-size:1.8mm; color:#475569;" id="printDate"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="footer-left"><strong>BP3KP Jawa IV</strong><br>Jl. Gayung Kebonsari 50, Surabaya</div>
            <div class="footer-right">Dashboard BSPS Jawa Timur 2026 | Tahap I</div>
        </div>
    </div>

    <script>
        let allData = { desa: [], kota: [], pesisir: [] };

        // Approximate positions for kabupaten/kota on the map (as percentage)
        const kabPositions = {
            'KAB. PACITAN': { x: 8, y: 65, type: 'green' },
            'KAB. MADIUN': { x: 18, y: 45, type: 'green' },
            'KAB. NGANJUK': { x: 28, y: 50, type: 'green' },
            'KAB. BOJONEGORO': { x: 35, y: 30, type: 'green' },
            'KAB. JOMBANG': { x: 42, y: 55, type: 'green' },
            'KAB. GRESIK': { x: 52, y: 40, type: 'green' },
            'KAB. PASURUAN': { x: 62, y: 65, type: 'green' },
            'KAB. MALANG': { x: 70, y: 75, type: 'green' },
            'KOTA MALANG': { x: 72, y: 60, type: 'purple' },
            'KOTA PASURUAN': { x: 60, y: 50, type: 'purple' },
            'KAB. JEMBER': { x: 82, y: 70, type: 'green' },
            'KAB. SITUBONDO': { x: 88, y: 45, type: 'blue' },
            'KAB. BANYUWANGI': { x: 95, y: 60, type: 'blue' }
        };

        async function loadAllData() {
            try {
                const [d1, d2, d3] = await Promise.all([
                    fetch('data_desa.json').then(r => r.json()),
                    fetch('data_kota.json').then(r => r.json()),
                    fetch('data_pesisir.json').then(r => r.json())
                ]);
                allData = { desa: d1, kota: d2, pesisir: d3 };
                renderAll();
            } catch (e) { console.error(e); }
        }

        function renderAll() {
            const { desa, kota, pesisir } = allData;
            const totalUnit = desa.reduce((s, i) => s + i.j, 0) + kota.reduce((s, i) => s + i.j, 0) + pesisir.reduce((s, i) => s + i.j, 0);
            const totalLokasi = desa.length + kota.length + pesisir.length;
            const allKab = [...new Set([...desa, ...kota, ...pesisir].map(i => i.kb))];

            document.getElementById('grandTotal').textContent = totalUnit.toLocaleString('id-ID');
            document.getElementById('grandDesa').innerHTML = `${totalLokasi} <span>Lokasi</span>`;
            document.getElementById('grandKab').innerHTML = `${allKab.length} <span>Wilayah</span>`;

            renderCategory(desa, 'desa');
            renderCategory(kota, 'kota');
            renderCategory(pesisir, 'pesisir');
            renderChart();
            renderMapLabels();
            document.getElementById('printDate').textContent = new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }

        function renderMapLabels() {
            const { desa, kota, pesisir } = allData;
            const all = [...desa, ...kota, ...pesisir];
            const grouped = {};
            all.forEach(i => { grouped[i.kb] = (grouped[i.kb] || 0) + i.j; });

            const labelsHtml = Object.entries(grouped).map(([kab, unit]) => {
                const pos = kabPositions[kab];
                if (!pos) return '';
                const shortName = kab.replace('KAB. ', '').replace('KOTA ', '');
                return `<div class="map-label ${pos.type}" style="left:${pos.x}%;top:${pos.y}%;">
                    <span class="map-label-value">${unit}</span>
                    <span class="map-label-name">${shortName}</span>
                </div>`;
            }).join('');

            document.getElementById('mapLabels').innerHTML = labelsHtml;
        }

        function renderCategory(data, prefix) {
            const total = data.reduce((s, i) => s + i.j, 0);
            const grouped = {};
            data.forEach(i => { grouped[i.kb] = (grouped[i.kb] || 0) + i.j; });
            const sorted = Object.entries(grouped).sort((a, b) => b[1] - a[1]);

            document.getElementById(`${prefix}-unit`).textContent = total.toLocaleString('id-ID');
            document.getElementById(`${prefix}-count`).textContent = data.length;
            document.getElementById(`${prefix}-breakdown`).innerHTML = sorted.map(([kab, unit]) =>
                `<div class="cat-row"><span class="cat-kab">${kab.replace('KAB. ', '').replace('KOTA ', '')}</span><span class="cat-unit">${unit}</span></div>`
            ).join('');
        }

        function renderChart() {
            const { desa, kota, pesisir } = allData;
            const all = [...desa, ...kota, ...pesisir];
            const grouped = {};
            all.forEach(i => { grouped[i.kb] = (grouped[i.kb] || 0) + i.j; });
            const sorted = Object.entries(grouped).sort((a, b) => b[1] - a[1]);
            const max = sorted[0]?.[1] || 1;

            const colors = {
                'KAB. PACITAN': '#22c55e', 'KAB. MALANG': '#22c55e', 'KAB. PASURUAN': '#22c55e',
                'KAB. JOMBANG': '#22c55e', 'KAB. NGANJUK': '#22c55e', 'KAB. MADIUN': '#22c55e',
                'KAB. BOJONEGORO': '#22c55e', 'KAB. JEMBER': '#22c55e', 'KAB. GRESIK': '#22c55e',
                'KOTA MALANG': '#a855f7', 'KOTA PASURUAN': '#a855f7',
                'KAB. BANYUWANGI': '#0ea5e9', 'KAB. SITUBONDO': '#0ea5e9'
            };

            document.getElementById('chartBars').innerHTML = sorted.map(([kab, unit]) => {
                const pct = (unit / max * 100).toFixed(0);
                const color = colors[kab] || '#64748b';
                return `<div class="bar-row"><div class="bar-label">${kab.replace('KAB. ', '').replace('KOTA ', '')}</div><div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:${color};"><span class="bar-value">${unit}</span></div></div></div>`;
            }).join('');
        }

        loadAllData();
    </script>
</body>

</html>